---
// src/components/blog/Sidebar.astro
import { Calendar, MapPin, ArrowRight } from 'lucide-react';
import { Image } from 'astro:assets';
import { getEntry } from 'astro:content';

// 1. è®€å– Keystatic Singleton è³‡æ–™
const settingsEntry = await getEntry('settings', 'global');
// ğŸŸ¢ æ–°å¢é€™æ®µé˜²å‘†æª¢æŸ¥
if (!settingsEntry) {
  // å¦‚æœæ‰¾ä¸åˆ°è¨­å®šæª”ï¼Œç‚ºäº†ä¸è®“ç¶²é æ›æ‰ï¼Œæˆ‘å€‘å¯ä»¥é¸æ“‡æ‹‹å‡ºéŒ¯èª¤æç¤ºé–‹ç™¼è€…
  throw new Error('ç„¡æ³•è®€å–å…¨ç«™è¨­å®š (src/content/settings/global.yaml)ã€‚è«‹ç¢ºèª Keystatic å¾Œå°æ˜¯å¦å·²å„²å­˜éã€Œå…¨ç«™è³‡è¨Šã€ã€‚');
}
const settings = settingsEntry.data;

// 2. è™•ç†é è¨­åœ–ç‰‡ (é˜²å‘†æ©Ÿåˆ¶ï¼šå¦‚æœå­¸é•·æ²’ä¸Šå‚³ç…§ç‰‡ï¼Œçµ¦ä¸€å¼µé è¨­åœ–)
// é€™è£¡å¯ä»¥å…ˆ import ä¸€å¼µæœ¬åœ°çš„é è¨­åœ–ï¼Œä»¥é˜²è¬ä¸€
import defaultAvatar from '../../assets/drchou-profile-2.png' 
---


<aside class="space-y-8 sticky top-24">
  
  {/* 1. é†«å¸«ç°¡ä»‹å¡ç‰‡ */}
  <div class="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm text-center">
    <div class="w-24 h-24 mx-auto rounded-full bg-highlight overflow-hidden mb-4 border-4 border-white shadow-md relative group">
      {settings.avatar ? (
        <Image 
          src={settings.avatar}
          alt={`${settings.doctorName}é†«å¸«`} 
          class="w-full h-full object-cover object-top transition-transform duration-500 group-hover:scale-110"
          width={200} 
          height={200}
        />
      ) : (
        /* å¦‚æœæ²’ä¸Šå‚³åœ–ç‰‡é¡¯ç¤ºçš„ä½”ä½ç¬¦ */
        <div class="w-full h-full flex items-center justify-center text-accent text-2xl font-bold bg-bg">
           {settings.doctorName[0]}
        </div>
      )}
    </div>
    
{/* å§“åèˆ‡è·ç¨± */}
    <h3 class="text-xl font-serif font-bold text-primary mb-1">
      {settings.doctorName} <span class="text-sm font-sans font-normal text-text">{settings.doctorTitle}</span>
    </h3>
    
    {/* è¨ºæ‰€åç¨± */}
    <p class="text-xs font-bold text-accent tracking-wider uppercase mb-4">
      {settings.clinicName}
    </p>
    
    {/* å´é‚Šæ¬„ç°¡ä»‹ */}
    <p class="text-sm text-text/80 leading-relaxed mb-6 text-justify">
      {settings.sidebarIntro}
    </p>
    
    {/* é€£çµåˆ°é—œæ–¼æˆ‘çš„æŒ‰éˆ• */}
    <a 
      href="/#about" 
      class="text-sm font-bold text-primary hover:text-accent transition-colors flex items-center justify-center gap-1 group"
    >
      å®Œæ•´å­¸ç¶“æ­· <ArrowRight size={14} className="group-hover:translate-x-1 transition-transform"/>
    </a>
  </div>

  {/* 2. é ç´„ CTA å¡ç‰‡ */}
  <div class="bg-primary rounded-2xl p-6 text-white text-center shadow-lg relative overflow-hidden group">
    {/* è£é£¾èƒŒæ™¯ */}
    <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-xl -translate-y-1/2 translate-x-1/2"></div>
    
    <h3 class="text-lg  text-white font-bold mb-2 relative z-10">å—å¤ äº†é »å°¿å›°æ“¾ï¼Ÿ</h3>
    <p class="text-sm text-gray-300 mb-6 relative z-10">
      åˆ¥è®“ç—‡ç‹€å½±éŸ¿ç”Ÿæ´»å“è³ªï¼Œç«‹å³é ç´„è«®è©¢ã€‚
    </p>
    
    <a 
      href="/#clinic" 
      class="block w-full py-3 bg-accent hover:bg-white hover:text-primary text-white font-bold rounded-xl transition-all shadow-md active:scale-95 relative z-10"
    >
      é ç´„é–€è¨º
    </a>
  </div>

</aside>