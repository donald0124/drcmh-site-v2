---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Image } from 'astro:assets';

// 1. 生成靜態路徑 (Static Paths)
export async function getStaticPaths() {
  const posts = await getCollection('news');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
// 2. 渲染內文 (Astro 5.0+ 使用 render 函式)
const { Content } = await render(post);

function formatDate(date: Date) {
  return new Date(date).toLocaleDateString('zh-TW', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<Layout title={`${post.data.title} | 最新消息`}>
  <article class="py-16 bg-white min-h-screen">
    {/* Pagefind 搜尋範圍起點 */}
    <div class="container mx-auto px-4 max-w-3xl" data-pagefind-body>
      
      {/* 麵包屑 (不索引) */}
      <nav class="mb-8 text-sm text-gray-500 flex items-center gap-2" data-pagefind-ignore>
        <a href="/" class="hover:text-primary transition-colors">首頁</a>
        <span>/</span>
        <a href="/news" class="hover:text-primary transition-colors">最新消息</a>
        <span>/</span>
        <span class="text-gray-900 truncate max-w-[200px]">{post.data.title}</span>
      </nav>

      {/* 文章標頭 */}
      <header class="mb-10 text-center">
        <div class="inline-block px-3 py-1 rounded-full bg-blue-50 text-blue-600 text-sm font-medium mb-4">
          {post.data.category === 'announcement' ? '診所公告' : 
           post.data.category === 'closed' ? '停診通知' : '活動快訊'}
        </div>
        
        {/* 標題權重加重 */}
        <h1 class="text-3xl md:text-4xl font-serif font-bold text-gray-900 mb-4 leading-tight" data-pagefind-weight="10">
          {post.data.title}
        </h1>
        
        <time class="text-gray-500 font-medium">
          {formatDate(post.data.date)}
        </time>
      </header>

      {/* 封面圖 */}
      {post.data.coverImage && (
        <div class="mb-12 rounded-2xl overflow-hidden shadow-lg aspect-video relative">
          <Image 
            src={post.data.coverImage} 
            alt={post.data.title}
            class="w-full h-full object-cover"
            priority
          />
        </div>
      )}

      {/* 內文區塊 (使用 Typography Plugin 樣式) */}
      <div class="prose prose-lg prose-slate max-w-none prose-headings:text-primary prose-a:text-accent prose-img:rounded-xl">
        <Content />
      </div>

      {/* 底部返回按鈕 */}
      <div class="mt-16 pt-8 border-t border-gray-100 text-center" data-pagefind-ignore>
        <a href="/news" class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-gray-100 text-gray-700 font-bold hover:bg-gray-200 transition-colors">
          <i class="fa-solid fa-arrow-left"></i> 返回列表
        </a>
      </div>

    </div>
  </article>
</Layout>